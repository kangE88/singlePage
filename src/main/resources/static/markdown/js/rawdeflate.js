/*
 * $Id: rawdeflate.js,v 0.3 2009/03/01 19:05:05 dankogai Exp dankogai $
 *
 * Original:
 *   http://www.onicos.com/staff/iz/amuse/javascript/expert/deflate.txt
 */
!function(){var r=32768,n=0,e=1,f=2,t=6,o=!0,a=32768,i=64,l=8192,c=2*r,u=3,d=258,w=16,s=8192,_=13;s>a&&alert("error: zip_INBUFSIZ is too small"),r<<1>1<<w&&alert("error: zip_WSIZE is too large"),_>w-1&&alert("error: zip_HASH_BITS is too large"),(8>_||258!=d)&&alert("error: Code too clever");var h,v,y,x,A,m,g,b,p,I,z,S,C,D,R,j,k,B,H,Z,E,F,N,T,U,W,q,G,J,K,L,M,O,P,Q,V,X,Y,$,rr,nr,er,fr,tr,or,ar,ir,lr,cr,ur,dr,wr,sr,_r,hr,vr,yr=s,xr=1<<_,Ar=xr-1,mr=r-1,gr=0,br=4096,pr=d+u+1,Ir=r-pr,zr=1,Sr=15,Cr=7,Dr=29,Rr=256,jr=256,kr=Rr+1+Dr,Br=30,Hr=19,Zr=16,Er=17,Fr=18,Nr=2*kr+1,Tr=parseInt((_+u-1)/u),Ur=null,Wr=function(){this.fc=0,this.dl=0},qr=function(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0},Gr=function(r,n,e,f){this.good_length=r,this.max_lazy=n,this.nice_length=e,this.max_chain=f},Jr=function(){this.next=null,this.len=0,this.ptr=new Array(l),this.off=0},Kr=new Array(0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0),Lr=new Array(0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13),Mr=new Array(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7),Or=new Array(16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15),Pr=new Array(new Gr(0,0,0,0),new Gr(4,4,8,4),new Gr(4,5,16,8),new Gr(4,6,32,32),new Gr(4,4,16,16),new Gr(8,16,32,32),new Gr(8,16,128,128),new Gr(8,32,128,256),new Gr(32,128,258,1024),new Gr(32,258,258,4096)),Qr=function(r){var n;if(r?1>r?r=1:r>9&&(r=9):r=t,q=r,x=!1,N=!1,null==Ur){for(h=v=y=null,Ur=new Array(l),b=new Array(c),p=new Array(yr),I=new Array(a+i),z=new Array(1<<w),K=new Array(Nr),n=0;Nr>n;n++)K[n]=new Wr;for(L=new Array(2*Br+1),n=0;2*Br+1>n;n++)L[n]=new Wr;for(M=new Array(kr+2),n=0;kr+2>n;n++)M[n]=new Wr;for(O=new Array(Br),n=0;Br>n;n++)O[n]=new Wr;for(P=new Array(2*Hr+1),n=0;2*Hr+1>n;n++)P[n]=new Wr;Q=new qr,V=new qr,X=new qr,Y=new Array(Sr+1),$=new Array(2*kr+1),er=new Array(2*kr+1),fr=new Array(d-u+1),tr=new Array(512),or=new Array(Dr),ar=new Array(Br),ir=new Array(parseInt(s/8))}},Vr=function(r){r.next=h,h=r},Xr=function(){var r;return null!=h?(r=h,h=h.next):r=new Jr,r.next=null,r.len=r.off=0,r},Yr=function(n){return z[r+n]},$r=function(n,e){return z[r+n]=e},rn=function(r){Ur[m+A++]=r,m+A==l&&Hn()},nn=function(r){r&=65535,l-2>m+A?(Ur[m+A++]=255&r,Ur[m+A++]=r>>>8):(rn(255&r),rn(r>>>8))},en=function(){R=(R<<Tr^255&b[E+u-1])&Ar,j=Yr(R),z[E&mr]=j,$r(R,E)},fn=function(r,n){jn(n[r].fc,n[r].dl)},tn=function(r){return 255&(256>r?tr[r]:tr[256+(r>>7)])},on=function(r,n,e){return r[n].fc<r[e].fc||r[n].fc==r[e].fc&&er[n]<=er[e]},an=function(r,n,e){var f;for(f=0;e>f&&vr<hr.length;f++)r[n+f]=255&hr.charCodeAt(vr++);return f},ln=function(){var n;for(n=0;xr>n;n++)z[r+n]=0;if(W=Pr[q].max_lazy,G=Pr[q].good_length,o||(J=Pr[q].nice_length),U=Pr[q].max_chain,E=0,D=0,T=an(b,0,2*r),0>=T)return N=!0,void(T=0);for(N=!1;pr>T&&!N;)un();for(R=0,n=0;u-1>n;n++)R=(R<<Tr^255&b[n])&Ar},cn=function(r){var n,e,f=U,t=E,a=Z,i=E>Ir?E-Ir:gr,l=E+d,c=b[t+a-1],u=b[t+a];Z>=G&&(f>>=2);do if(n=r,b[n+a]==u&&b[n+a-1]==c&&b[n]==b[t]&&b[++n]==b[t+1]){t+=2,n++;do;while(b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&b[++t]==b[++n]&&l>t);if(e=d-(l-t),t=l-d,e>a){if(F=r,a=e,o){if(e>=d)break}else if(e>=J)break;c=b[t+a-1],u=b[t+a]}}while((r=z[r&mr])>i&&0!=--f);return a},un=function(){var n,e,f=c-T-E;if(-1==f)f--;else if(E>=r+Ir){for(n=0;r>n;n++)b[n]=b[n+r];for(F-=r,E-=r,D-=r,n=0;xr>n;n++)e=Yr(n),$r(n,e>=r?e-r:gr);for(n=0;r>n;n++)e=z[n],z[n]=e>=r?e-r:gr;f+=r}N||(n=an(b,E+T,f),0>=n?N=!0:T+=n)},dn=function(){for(;0!=T&&null==v;){var r;if(en(),j!=gr&&Ir>=E-j&&(H=cn(j),H>T&&(H=T)),H>=u)if(r=Cn(E-F,H-u),T-=H,W>=H){H--;do E++,en();while(0!=--H);E++}else E+=H,H=0,R=255&b[E],R=(R<<Tr^255&b[E+1])&Ar;else r=Cn(0,255&b[E]),T--,E++;for(r&&(Sn(0),D=E);pr>T&&!N;)un()}},wn=function(){for(;0!=T&&null==v;){if(en(),Z=H,k=F,H=u-1,j!=gr&&W>Z&&Ir>=E-j&&(H=cn(j),H>T&&(H=T),H==u&&E-F>br&&H--),Z>=u&&Z>=H){var r;r=Cn(E-1-k,Z-u),T-=Z-1,Z-=2;do E++,en();while(0!=--Z);B=0,H=u-1,E++,r&&(Sn(0),D=E)}else 0!=B?(Cn(0,255&b[E-1])&&(Sn(0),D=E),E++,T--):(B=1,E++,T--);for(;pr>T&&!N;)un()}},sn=function(){N||(S=0,C=0,vn(),ln(),v=null,A=0,m=0,3>=q?(Z=u-1,H=0):(H=u-1,B=0),g=!1)},_n=function(r,n,e){var f;return x||(sn(),x=!0,0!=T)?(f=hn(r,n,e))==e?e:g?f:(3>=q?dn():wn(),0==T&&(0!=B&&Cn(0,255&b[E-1]),Sn(1),g=!0),f+hn(r,f+n,e-f)):(g=!0,0)},hn=function(r,n,e){var f,t,o;for(f=0;null!=v&&e>f;){for(t=e-f,t>v.len&&(t=v.len),o=0;t>o;o++)r[n+f+o]=v.ptr[v.off+o];if(v.off+=t,v.len-=t,f+=t,0==v.len){var a;a=v,v=v.next,Vr(a)}}if(f==e)return f;if(A>m){for(t=e-f,t>A-m&&(t=A-m),o=0;t>o;o++)r[n+f+o]=Ur[m+o];m+=t,f+=t,A==m&&(A=m=0)}return f},vn=function(){var r,n,e,f,t;if(0==O[0].dl){for(Q.dyn_tree=K,Q.static_tree=M,Q.extra_bits=Kr,Q.extra_base=Rr+1,Q.elems=kr,Q.max_length=Sr,Q.max_code=0,V.dyn_tree=L,V.static_tree=O,V.extra_bits=Lr,V.extra_base=0,V.elems=Br,V.max_length=Sr,V.max_code=0,X.dyn_tree=P,X.static_tree=null,X.extra_bits=Mr,X.extra_base=0,X.elems=Hr,X.max_length=Cr,X.max_code=0,e=0,f=0;Dr-1>f;f++)for(or[f]=e,r=0;r<1<<Kr[f];r++)fr[e++]=f;for(fr[e-1]=f,t=0,f=0;16>f;f++)for(ar[f]=t,r=0;r<1<<Lr[f];r++)tr[t++]=f;for(t>>=7;Br>f;f++)for(ar[f]=t<<7,r=0;r<1<<Lr[f]-7;r++)tr[256+t++]=f;for(n=0;Sr>=n;n++)Y[n]=0;for(r=0;143>=r;)M[r++].dl=8,Y[8]++;for(;255>=r;)M[r++].dl=9,Y[9]++;for(;279>=r;)M[r++].dl=7,Y[7]++;for(;287>=r;)M[r++].dl=8,Y[8]++;for(mn(M,kr+1),r=0;Br>r;r++)O[r].dl=5,O[r].fc=kn(r,5);yn()}},yn=function(){var r;for(r=0;kr>r;r++)K[r].fc=0;for(r=0;Br>r;r++)L[r].fc=0;for(r=0;Hr>r;r++)P[r].fc=0;K[jr].fc=1,sr=_r=0,lr=cr=ur=0,dr=0,wr=1},xn=function(r,n){for(var e=$[n],f=n<<1;rr>=f&&(rr>f&&on(r,$[f+1],$[f])&&f++,!on(r,e,$[f]));)$[n]=$[f],n=f,f<<=1;$[n]=e},An=function(r){var n,e,f,t,o,a,i=r.dyn_tree,l=r.extra_bits,c=r.extra_base,u=r.max_code,d=r.max_length,w=r.static_tree,s=0;for(t=0;Sr>=t;t++)Y[t]=0;for(i[$[nr]].dl=0,n=nr+1;Nr>n;n++)e=$[n],t=i[i[e].dl].dl+1,t>d&&(t=d,s++),i[e].dl=t,e>u||(Y[t]++,o=0,e>=c&&(o=l[e-c]),a=i[e].fc,sr+=a*(t+o),null!=w&&(_r+=a*(w[e].dl+o)));if(0!=s){do{for(t=d-1;0==Y[t];)t--;Y[t]--,Y[t+1]+=2,Y[d]--,s-=2}while(s>0);for(t=d;0!=t;t--)for(e=Y[t];0!=e;)f=$[--n],f>u||(i[f].dl!=t&&(sr+=(t-i[f].dl)*i[f].fc,i[f].fc=t),e--)}},mn=function(r,n){var e,f,t=new Array(Sr+1),o=0;for(e=1;Sr>=e;e++)o=o+Y[e-1]<<1,t[e]=o;for(f=0;n>=f;f++){var a=r[f].dl;0!=a&&(r[f].fc=kn(t[a]++,a))}},gn=function(r){var n,e,f=r.dyn_tree,t=r.static_tree,o=r.elems,a=-1,i=o;for(rr=0,nr=Nr,n=0;o>n;n++)0!=f[n].fc?($[++rr]=a=n,er[n]=0):f[n].dl=0;for(;2>rr;){var l=$[++rr]=2>a?++a:0;f[l].fc=1,er[l]=0,sr--,null!=t&&(_r-=t[l].dl)}for(r.max_code=a,n=rr>>1;n>=1;n--)xn(f,n);do n=$[zr],$[zr]=$[rr--],xn(f,zr),e=$[zr],$[--nr]=n,$[--nr]=e,f[i].fc=f[n].fc+f[e].fc,er[n]>er[e]+1?er[i]=er[n]:er[i]=er[e]+1,f[n].dl=f[e].dl=i,$[zr]=i++,xn(f,zr);while(rr>=2);$[--nr]=$[zr],An(r),mn(f,a)},bn=function(r,n){var e,f,t=-1,o=r[0].dl,a=0,i=7,l=4;for(0==o&&(i=138,l=3),r[n+1].dl=65535,e=0;n>=e;e++)f=o,o=r[e+1].dl,++a<i&&f==o||(l>a?P[f].fc+=a:0!=f?(f!=t&&P[f].fc++,P[Zr].fc++):10>=a?P[Er].fc++:P[Fr].fc++,a=0,t=f,0==o?(i=138,l=3):f==o?(i=6,l=3):(i=7,l=4))},pn=function(r,n){var e,f,t=-1,o=r[0].dl,a=0,i=7,l=4;for(0==o&&(i=138,l=3),e=0;n>=e;e++)if(f=o,o=r[e+1].dl,!(++a<i&&f==o)){if(l>a){do fn(f,P);while(0!=--a)}else 0!=f?(f!=t&&(fn(f,P),a--),fn(Zr,P),jn(a-3,2)):10>=a?(fn(Er,P),jn(a-3,3)):(fn(Fr,P),jn(a-11,7));a=0,t=f,0==o?(i=138,l=3):f==o?(i=6,l=3):(i=7,l=4)}},In=function(){var r;for(bn(K,Q.max_code),bn(L,V.max_code),gn(X),r=Hr-1;r>=3&&0==P[Or[r]].dl;r--);return sr+=3*(r+1)+5+5+4,r},zn=function(r,n,e){var f;for(jn(r-257,5),jn(n-1,5),jn(e-4,4),f=0;e>f;f++)jn(P[Or[f]].dl,3);pn(K,r-1),pn(L,n-1)},Sn=function(r){var t,o,a,i;if(i=E-D,ir[ur]=dr,gn(Q),gn(V),a=In(),t=sr+3+7>>3,o=_r+3+7>>3,t>=o&&(t=o),t>=i+4&&D>=0){var l;for(jn((n<<1)+r,3),Bn(),nn(i),nn(~i),l=0;i>l;l++)rn(b[D+l])}else o==t?(jn((e<<1)+r,3),Dn(M,O)):(jn((f<<1)+r,3),zn(Q.max_code+1,V.max_code+1,a+1),Dn(K,L));yn(),0!=r&&Bn()},Cn=function(r,n){if(I[lr++]=n,0==r?K[n].fc++:(r--,K[fr[n]+Rr+1].fc++,L[tn(r)].fc++,p[cr++]=r,dr|=wr),wr<<=1,0==(7&lr)&&(ir[ur++]=dr,dr=0,wr=1),q>2&&0==(4095&lr)){var e,f=8*lr,t=E-D;for(e=0;Br>e;e++)f+=L[e].fc*(5+Lr[e]);if(f>>=3,cr<parseInt(lr/2)&&f<parseInt(t/2))return!0}return lr==s-1||cr==yr},Dn=function(r,n){var e,f,t,o,a=0,i=0,l=0,c=0;if(0!=lr)do 0==(7&a)&&(c=ir[l++]),f=255&I[a++],0==(1&c)?fn(f,r):(t=fr[f],fn(t+Rr+1,r),o=Kr[t],0!=o&&(f-=or[t],jn(f,o)),e=p[i++],t=tn(e),fn(t,n),o=Lr[t],0!=o&&(e-=ar[t],jn(e,o))),c>>=1;while(lr>a);fn(jr,r)},Rn=16,jn=function(r,n){C>Rn-n?(S|=r<<C,nn(S),S=r>>Rn-C,C+=n-Rn):(S|=r<<C,C+=n)},kn=function(r,n){var e=0;do e|=1&r,r>>=1,e<<=1;while(--n>0);return e>>1},Bn=function(){C>8?nn(S):C>0&&rn(S),S=0,C=0},Hn=function(){if(0!=A){var r,n;for(r=Xr(),null==v?v=y=r:y=y.next=r,r.len=A-m,n=0;n<r.len;n++)r.ptr[n]=Ur[m+n];A=m=0}},Zn=function(r,n){var e,f;hr=r,vr=0,"undefined"==typeof n&&(n=t),Qr(n);for(var o=new Array(1024),a=[];(e=_n(o,0,o.length))>0;){var i=new Array(e);for(f=0;e>f;f++)i[f]=String.fromCharCode(o[f]);a[a.length]=i.join("")}return hr=null,a.join("")};window.RawDeflate||(RawDeflate={}),RawDeflate.deflate=Zn}();